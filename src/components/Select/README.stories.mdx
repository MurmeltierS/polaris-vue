import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import { Select, Icon } from '@/polaris-vue';
import dedent from 'ts-dedent';

import HintMajor from '@icons/HintMajor.svg';

<Meta
  title="Components / Forms / Select"
  component={ Select }
  argTypes={{
    options: {
      name: 'options',
      control: {
        type: 'object',
      },
      defaultValue: [
        { "label": "Today", "value": "today" },
        { "label": "Yesterday", "value": "yesterday" },
        { "label": "Last 7 days", "value": "lastWeek" },
        { "id": "hint", "label": "Option with icon", "value": "hint" },
        { "label": "Option disabled", "value": "disabled", "disabled": true },
      ],
      table: {
        type: {
          summary: null,
        },
      },
    },
    error: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string | component',
        },
      },
    },
    value: {
      table: {
        disable: true,
      },
    },
    blur: {
      control: false,
      description: 'Callback when focus is removed',
      table: {
        type: {
          summary: null,
        },
      },
    },
    focus: {
      control: false,
      description: 'Callback when select is focused',
      table: {
        type: {
          summary: null,
        },
      },
    },
    input: {
      control: false,
      table: {
        type: {
          summary: 'Return: selected value',
        },
      },
    },
    change: {
      control: false,
      table: {
        type: {
          summary: 'Return: selected value',
        },
      },
    },
    'help-text': {
      control: {
        type: 'text',
      },
      table: {
        category: 'Slots',
        type: {
          summary: null,
        },
      },
    },
    label: {
      control: {
        type: 'text',
      },
      table: {
        category: 'Slots',
        type: {
          summary: null,
        },
      },
    },
    default: {
      table: {
        disable: true,
      },
    },
    prefix: {
      name: 'prefix-{option-id}',
      description: 'Slot to custom prefix for each option by `option-id`',
      controls: null,
      table: {
        category: 'Slots',
        type: {
          summary: null,
        },
      },
    },
  }}
/>

export const Template = (args, { argTypes }) => ({
  props: Object.keys(argTypes),
  components: { Select, Icon },
  data() {
    return {
      selectValue: 'today',
      iconHintMajor: HintMajor,
      propsExtend: {
        ...this.$props,
        options: [
          ...this.$props.options,
        ],
      },
      helpText: argTypes['help-text'],
      label: argTypes['label'],
    };
  },
  created() {
    delete this.propsExtend['helpText'];
    delete this.propsExtend['label'];
  },
  template: `<div><Select v-bind="propsExtend" v-model="selectValue">
    <template slot="label">{{ label || 'Date Range' }}</template>
    <template v-if="helpText" slot="help-text">{{ helpText }}</template>
    <Icon :source="iconHintMajor" slot="prefix-hint" />
  </Select>
  <br/>
  <strong>Value selected:</strong> {{ selectValue }}
  </div>`,
});

# Select

Select lets merchants choose one option from an options menu. Consider select when you have 4 or more options, to avoid cluttering the interface.

<font color="#FF7900">Use component with camel case for prevent conflict with <b>select</b> element in html.</font>

<Canvas>
  <Story
    name="Select"
    parameters={{
      docs: {
        transformSource: (source) => {
          const tmpSource = source
            .replace(/<div>\s*/,'')
            .replace(/\s*<\/div>/,'')
            .replace(/\s*<br\s\/>\s*<strong>(.*)<\/strong>\s*today/,'')
            .replace(/value=".*"\s*/, '')
            .replace(/:source='.*'\s*/, ':source="iconHintMajor"')
            .replace(/:options='(.*)'/, ':options="options" v-model="selectValue"');
          const fullSource = dedent`
            ${tmpSource}
            data() {
              return {
                options: [
                  { "label": "Today", "value": "today" },
                  { "label": "Yesterday", "value": "yesterday" },
                  { "label": "Last 7 days", "value": "lastWeek" },
                  { "id": "hint", "label": "Option with icon", "value": "hint" },
                  { "label": "Option disabled", "value": "disabled", "disabled": true },
                ],
              };
            },
          `;
          return fullSource;
        },
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Select" />
