import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import dedent from 'ts-dedent';

import {
  TextField,
  ChoiceList,
  Stack,
  StackItem,
  Select,
  FormLayout,
  FormGroup,
  FormItem,
  InlineError,
} from '@/polaris-vue';

<Meta
  title="Components / Forms / TextField"
  component={ TextField }
  argTypes={{
    default: {
      control: {
        type: 'text',
      },
      table: {
        disable: true,
      },
    },
    align: {
      control: {
        type: 'select',
        options: ['left', 'center', 'right'],
      },
      table: {
        type: {
          summary: 'string',
        },
      },
    },
    ariaActiveDescendant: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    ariaAutocomplete: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    ariaControls: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    ariaExpanded: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    ariaOwns: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    autoComplete: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    autoFocus: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    clearButton: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    disabled: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    error: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string | component'
        },
      },
    },
    focused: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    id: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    inputMode: {
      control: {
        type: 'select',
        options: ["none", "text", "decimal", "numeric", "tel", "search", "email", "url"]
      },
      table: {
        type: {
          summary: '"none" | "text" | "decimal" | "numeric" | "tel" | "search" | "email" | "url"'
        },
      },
    },
    labelAction: {
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    labelHidden: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    max: {
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: 'string | number'
        },
      },
    },
    maxHeight: {
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: 'string | number'
        },
      },
    },
    maxLength: {
      control: {
        type: 'number',
      },
      table: {
        type: {
          summary: 'number'
        },
      },
    },
    min: {
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: 'string | number'
        },
      },
    },
    minLength: {
      control: {
        type: 'number',
      },
      table: {
        type: {
          summary: 'number'
        },
      },
    },
    monospaced: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    multiline: {
      control: {
        type: 'number',
      },
      table: {
        type: {
          summary: 'boolean | number'
        },
      },
    },
    name: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    pattern: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    placeholder: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    readOnly: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    requiredIndicator: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    role: {
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    showCharacterCount: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    spellCheck: {
      control: {
        type: 'boolean',
      },
      table: {
        type: {
          summary: 'boolean'
        },
      },
    },
    step: {
      control: {
        type: 'number',
      },
      table: {
        type: {
          summary: 'number'
        },
      },
    },
    type: {
      control: {
        type: 'select',
        options: ["text", "password", "email", "number", "tel", "search", "url", "date", "datetime-local", "time", "month", "week", "color", "file"]
      },
      table: {
        type: {
          summary: '"text" | "password" | "email" | "number" | "tel" | "search" | "url" | "date" | "datetime-local" | "time" | "month" | "week" | "color" | "file"'
        },
      },
    },
    value: {
      description: 'Initial value for the input, v-model will auto bind to this prop',
      control: {
        type: 'text',
      },
      table: {
        type: {
          summary: 'string'
        },
      },
    },
    blur: {
      description: 'Callback when focus is removed',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: '() => void'
        },
      },
    },
    change: {
      description: 'Callback when value is changed',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: '(Event) => void'
        },
      },
    },
    'clear-button-click': {
      description: 'Call back when clear button is clicked',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: '(id: String) => void'
        },
      },
    },
    focus: {
      description: 'Callback when input is focused',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: '() => void'
        },
      },
    },
    input: {
      description: 'Input event using for v-model function',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: '(newVal: String) => void'
        },
      },
    },
    'connected-left': {
      control: {
        disable: true,
      },
      description: 'An element connected to the left of the input',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
    'connected-right': {
      control: {
        disable: true,
      },
      description: 'An element connected to the right of the input',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
    'help-text': {
      control: {
        disable: true,
      },
      description: 'Additional hint text to display',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
    label: {
      control: {
        disable: true,
      },
      description: 'Label for the input',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
    prefix: {
      control: {
        disable: true
      },
      description: 'Text to display before value',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
    suffix: {
      control: {
        disable: true
      },
      description: 'Text to display after value',
      table: {
        type: {
          summary: 'slot'
        },
      }
    },
  }}
/>

# Text field

A text field is an input field that merchants can type into. It has a range of options and supports several text formats including numbers.

<br/><br/>

### Default text field

Use to allow merchants to provide text input when the expected input is short. For longer input, use the auto grow or multiline options.

export const DefaultTextField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="name"
      autoComplete="off"
    >
      <template slot="label">
        Your store name
      </template>
    </TextField>
    <p style="margin-top: 20px">Name: {{ name }}</p>
  </div>
  `,
  data() {
    return {
      name: 'Polaris',
    };
  },
});
DefaultTextField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value/, 'v-model')
        .replace(/"Polaris"/, '"name"')
        .replace(/Name: Polaris/, 'Name: {{ Polaris }}');
      return dedent`
        ${tmpSource}\n
        data() {
          return {
            name: 'Polaris',
          };
        }
      `;
    },
  },
};

<Canvas>
  <Story story={DefaultTextField} name="Default text field"></Story>
</Canvas>

### Number field

Use when input text should be a number.

export const NumberField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      type="number"
      v-model="numberData"
      autoComplete="off"
    >
      <template slot="label">
        Quantity
      </template>
    </TextField>
    <p style="margin-top: 20px">Number: {{ numberData }}</p>
  </div>`,
  data() {
    return {
      numberData: '1',
    };
  },
});
NumberField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value/, 'v-model')
        .replace(/"1"/, '"numberData"')
        .replace(/Number: 1/, 'Number: {{ numberData }}');
      return dedent`
        ${tmpSource}\n
        data() {
          return {
            numberData: '1',
          };
        }
      `;
    },
  },
};

<Canvas>
  <Story story={NumberField} name="Number field"></Story>
</Canvas>

### Email field

Use when the text input should be an email address.

export const EmailField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      type="email"
      v-model="emailData"
      autoComplete="email"
    >
      <template slot="label">
        Email
      </template>
    </TextField>
    <p style="margin-top: 20px">Email: {{ emailData }}</p>
  </div>`,
  data() {
    return {
      emailData: 'polaris@vuejs.com',
    };
  },
});
EmailField.parameters = {
  docs: {
    source: false,
  },
};
EmailField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value/, 'v-model')
        .replace(/"polaris@vuejs.com"/, '"emailData"')
        .replace(/Email: polaris@vuejs.com/, 'Email: {{ emailData }}');
      return dedent`
        ${tmpSource}\n
        data() {
          return {
            emailData: 'polaris@vuejs.com',
          };
        }
      `;
    },
  },
};

<Canvas>
  <Story story={EmailField} name="Email field"></Story>
</Canvas>

### Multiline text field

Use when the expected input could be more than one line.
The field will automatically grow to accommodate additional text.

export const MultiLineField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="address"
      autoComplete="off"
      :multiline="4"
    >
      <template slot="label">
        Address
      </template>
    </TextField>
    <p style="margin-top: 20px">Address: {{ address }}</p>
  </div>`,
  data() {
    return {
      address: '156 Xa Dan 2',
    };
  },
});
MultiLineField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value/, 'v-model')
        .replace(/"156 Xa Dan 2"/, '"address"')
        .replace(/Address: 156 Xa Dan 2/, 'Address: {{ address }}');
      return dedent`
        ${tmpSource}\n
        data() {
          return {
            address: '156 Xa Dan 2',
          };
        }
      `;
    },
  },
};

<Canvas>
  <Story story={MultiLineField} name="Multiline text field" height="150px"></Story>
</Canvas>

### Text field with hidden label

Use to visually hide the label when the text field's purpose is clear from context.
The label will remain available to screen readers. Use this option with care. In almost all cases, show the label.

export const HiddenLabelField = (args, { argTypes }) => ({
  components: { TextField, ChoiceList },
  template: `
  <div>
    <ChoiceList :choices="choices" v-model="selected">
      Gift card auto-expiration
    </ChoiceList>
    <TextField
      type="number"
      v-model="months"
      autoComplete="off"
      :disabled="selected === 'no'"
      :labelHidden="true"
    >
    </TextField>
  </div>`,
  data() {false
    return {
      months: '12',
      choices: [
        {label: 'Gift cards never expire', value: 'no'},
        {label: 'Gift cards expire', value: 'yes'},
      ],
      selected: 'yes',
    };
  },
});
HiddenLabelField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value/g, 'v-model')
        .replace(/"yes"/g, '"selected"')
        .replace(/\'\[.*\]\'/, '"choices"')
        .replace(/"12"/g, '"months"')
        .replace(/:disabled="false"/, ':disabled="selected === \'no\'"')
      return dedent`
        ${tmpSource}\n
        import { ChoiceList } from '@/polaris-vue';\n
        components: {
          ChoiceList,
        },
        data() {
          return {
            months: '12',
            choices: [
              {label: 'Gift cards never expire', value: 'no'},
              {label: 'Gift cards expire', value: 'yes'},
            ],
            selected: 'yes'
          };
        }
      `;
    },
  },
};

<Canvas>
  <Story story={HiddenLabelField} name="Text field with hidden label"></Story>
</Canvas>

### Text field with label action

Use when an optional, secondary action is closely associated with a text field.
For example, on a field for entering a customs tariff code, a label action might be to look up the appropriate code from a table.

export const ActionLabelField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="text"
      autoComplete="off"
      :labelAction="labelAction"
    >
      <template slot="label">
        Tariff code
      </template>
    </TextField>
  </div>`,
  data() {
    return {
      text: 'Contents',
      labelAction: { content: 'Look up codes' }
    };
  },
});
ActionLabelField.parameters = {
  docs: {
    source: false
  },
};

<Canvas>
  <Story story={ActionLabelField} name="Text field with label action"></Story>
</Canvas>

### Text field with right aligned text

Use when input text should be aligned right.

export const RightAlignedField = (args, { argTypes }) => ({
  components: { TextField, Stack, StackItem },
  template: `
  <Stack>
    <StackItem :fill="true">
      Price
    </StackItem>
    <TextField
      v-model="price"
      autoComplete="off"
      align="right"
      :labelHidden="true"
    >
      <template slot="label">
        Price label
      </template>
    </TextField>
  </Stack>`,
  data() {
    return {
      price: '1',
    };
  },
});
RightAlignedField.parameters = {
  docs: {
    source: false
  },
};

<Canvas>
  <Story story={RightAlignedField} name="Text field with right aligned text"></Story>
</Canvas>

### Text field with placeholder text

Use to allow merchants to provide text input when the expected input is short. For longer input, use the auto grow or multiline options.

export const PlaceholderField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      autoComplete="off"
      placeholder="Example: North America, Europe"
    >
      <template slot="label">
        Shipping zone name
      </template>
    </TextField>
  </div>
  `,
});
PlaceholderField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={PlaceholderField} name="Text field with placeholder text"></Story>
</Canvas>

### Text field with help text

Use to show short instructional content below the text field.
Help text works to help merchants understand how to fix errors that result from incorrect formatting (such as dates or passwords with specific character requirements).
If more explanation is needed, link to the Shopify Help Center.

export const HelpTextField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      type="email"
      autoComplete="email"
    >
      <template slot="label">
        Account email
      </template>
      <template slot="help-text">
        We'll use this address if we need to contact you about your account.
      </template>
    </TextField>
  </div>
  `,
});
HelpTextField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={HelpTextField} name="Text field with help text"></Story>
</Canvas>

### Text field with prefix or suffix

Use as a special form of help text that works best inline.

* Use a prefix for things like currency symbols (“$”, “¥”, “£”).

* Use suffix for things like units of measure (“in”, “cm”).

export const PrefixSuffixField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="price"
      type="number"
      autoComplete="off"
    >
      <template slot="label">
        Price
      </template>
      <template slot="prefix">
        $
      </template>
    </TextField>
  </div>
  `,
  data() {
    return {
      price: '10',
    };
  },
});
PrefixSuffixField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={PrefixSuffixField} name="Text field with prefix or suffix"></Story>
</Canvas>

### Text field with connected fields

Use when a text field and several related fields make up a logical unit.

If inputting weight as a number and a separate unit of measurement,
use a text field with a select dropdown menu (for example “kg”, “lb”) as a connected field.

export const ConnectedField = (args, { argTypes }) => ({
  components: { TextField, Select },
  template: `
  <TextField
    v-model="weight"
    type="number"
    autoComplete="off"
  >
    <template slot="label">Weight</template>
    <template slot="connected-left">
      <Select
        v-model="unit"
        :options="['kg', 'lb']"
        :labelHidden="true"
      >
      </Select>
    </template>
  </TextField>
  `,
  data() {
    return {
      weight: '10',
      unit: 'kg'
    };
  },
});
ConnectedField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      
    }
  },
};

<Canvas>
  <Story story={ConnectedField} name="Text field with connected fields"></Story>
</Canvas>

### Text field with validation error

Use to let merchants know if their input is valid or if there's an error.
Whenever possible, validate input as soon as merchants have finished interacting with a field (but not before).
If a field already has an error, validate and remove errors as merchants type so they can immediately see when an error has been fixed.

export const ErrorField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      autoComplete="off"
      error="store name is required"
    >
      <template slot="label">
        Store name
      </template>
    </TextField>
  </div>
  `,
});
ErrorField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={ErrorField} name="Text field with validation error"></Story>
</Canvas>

### Text field with separate validation error

Use to let merchants know when their text field input is invalid in the context of a group of form inputs that the text field depends on.

When the error prop has a boolean value of true,
the text field component indicates to merchants that their input is invalid without rendering an error message directly below it.
It anticipates that an inline error component exists separately within the form.

To render an invalid text field and its validation error separately:

* Set a unique identifier on the text field component id prop

* Set a boolean on the text field component error prop

* Use an inline error component to describe the invalid text field input,
and set its fieldID prop to be the same unique indentifier as the text field component's id

export const SeparateErrField = (args, { argTypes }) => ({
  components: {
    TextField,
    Stack,
    StackItem,
    Select,
    FormLayout,
    FormGroup,
    FormItem,
    InlineError,
  },
  template: `
    <Stack :wrap="false" alignment="leading" spacing="loose">
      <StackItem :fill="true">
        <FormLayout>
          <FormGroup :condensed="true">
            <FormItem>
              <Select
                :labelHidden="true"
                value="Product type"
                :options="['Product type']"
              >
                <template slot="label">Collection rule type</template>
              </Select>
            </FormItem>
            <FormItem>
              <Select
                :labelHidden="true"
                value="is equal to"
                :options="['is equal to']"
              >
                <template slot="label">Collection rule condition</template>
              </Select>
            </FormItem>
            <FormItem>
              <TextField
                v-model="inputChar"
                autoComplete="off"
                :labelHidden="true"
                :error="isInvalid"
              >
              </TextField>
            </FormItem>
          </FormGroup>
        </FormLayout>
        <div v-if="isInvalid" style="margin-top: 4px">
          <InlineError
            fieldID="inline-err-id"
            message="Enter 3 or more characters for product type is equal to"
          />
        </div>
      </StackItem>
    </Stack>
    `,
  data() {
    return {
      inputChar: ''
    };
  },
  computed: {
    isInvalid() {
      return this.inputChar.length < 3;
    }
  }
});
SeparateErrField.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/value=""/, 'v-model="inputChar"')
      return dedent`
        ${tmpSource}\n
        import {
          Select,
          FormLayout,
          FormGroup,
          FormItem,
          Form,
          Stack,
          StackItem,
          InlineError,
        } from '@shopify/polaris';\n
        components: {
          Select,
          FormLayout,
          FormGroup,
          FormItem,
          Form,
          Stack,
          StackItem,
          InlineError,
        },
        data() {
          return {
            inputChar: '',
          };
        },
        computed: {
          isInvalid() {
            return this.inputChar.length < 3;
          }
        },
      `;
    },
  },
};

<Canvas>
  <Story story={SeparateErrField} name="Text field with separate validation error"></Story>
</Canvas>


### Disabled text field

Use to show that a textfield is not available for interaction.
Most often used in forms when information is required only in a particular state. For example, the text field next to Other in a choice list when Other is not selected.

export const DisabledField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      :disabled="true"
      autoComplete="off"
    >
      <template slot="label">
        Store name
      </template>
    </TextField>
  </div>
  `,
});
DisabledField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={DisabledField} name="Disabled text field"></Story>
</Canvas>

### Text field with character count

Use to display the current number of characters in a text field.
Use in conjunction with max length to display the current remaining number of characters in the text field.

export const CharCountField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="storeName"
      autoComplete="off"
      :maxLength="20"
      :showCharacterCount="true"
    >
      <template slot="label">
        Store name
      </template>
    </TextField>
  </div>
  `,
  data() {
    return {
      storeName: 'Jaded Pixel',
    };
  },
});
CharCountField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={CharCountField} name="Text field with character count"></Story>
</Canvas>

### Text field with clear button

Use to allow merchants to clear the content from a text field.

export const ClearBtnField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="storeName"
      autoComplete="off"
      :clearButton="true"
      @clear-button-click="storeName = ''"
    >
      <template slot="label">
        Store name
      </template>
    </TextField>
  </div>
  `,
  data() {
    return {
      storeName: 'Jaded Pixel',
    };
  },
});
ClearBtnField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={ClearBtnField} name="Text field with clear button"></Story>
</Canvas>

### Text field with monospaced font

Use to apply a monospaced font to the TextField

export const MonoFontField = (args, { argTypes }) => ({
  components: { TextField },
  template: `
  <div>
    <TextField
      v-model="storeName"
      autoComplete="off"
      :monospaced="true"
    >
      <template slot="label">
        Store name
      </template>
    </TextField>
  </div>
  `,
  data() {
    return {
      storeName: 'Jaded Pixel',
    };
  },
});
MonoFontField.parameters = {
  docs: {
    source: false,
  },
};

<Canvas>
  <Story story={MonoFontField} name="Text field with monospaced font"></Story>
</Canvas>

### Example

export const ExampleField = (args, { argTypes }) => ({
  props: Object.keys(argTypes),
  components: { TextField },
  template: `
    <TextField v-bind="$props" autoComplete="off">
      <template slot="label">Example text field</template>
    </TextField>
  `,
});

<Canvas>
  <Story story={ExampleField} name="Example"></Story>
</Canvas>

<ArgsTable story="Example" />
