import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import dedent from 'ts-dedent';
import {
  Popover, ActionList, Button, Pane, PopoverSection, FormLayout, FormItem, Select, TextField
} from '@/polaris-vue';

<Meta
  title="Components / Overlays / Popover"
  component={ Popover }
  argTypes={{
    preferredPosition: {
      name: 'preferredPosition',
      description: 'The preferred direction to open the popover',
      options: [
        'above',
        'below',
        'mostSpace'
      ],
      control: { type: 'select' },
      table: {
        defaultValue: {
          summary: 'below'
        },
        type: {
          summary: null,
        },
      },
    },
    preferredAlignment: {
      name: 'preferredAlignment',
      description: 'The preferred alignment of the popover relative to its activator',
      options: [
        'left',
        'center',
        'right'
      ],
      control: { type: 'select' },
      table: {
        defaultValue: {
          summary: 'center'
        },
        type: {
          summary: null,
        },
      },
    },
    autofocusTarget: {
      name: 'autofocusTarget',
      description: 'The preferred auto focus target defaulting to the popover container',
      options: [
        'container',
        'none',
        'first-node'
      ],
      control: { type: 'select' },
      table: {
        defaultValue: {
          summary: 'container'
        },
        type: {
          summary: null,
        },
      },
    },
    colorScheme: {
      options: [
        'light',
        'dark',
      ],
      control: { type: 'select' },
      table: {
        defaultValue: {
          summary: 'light'
        },
        type: {
          summary: 'dark | light',
        },
      }
    },
    'close': {
      name: 'close',
      description: 'Callback when popover is closed',
      control: { disable: true },
      table: {
        type: {
          summary: '"() => void"',
        },
      },
    },
    'scrolled-to-bottom': {
      name: 'scrolled-to-bottom',
      description: 'Callback when the bottom of the popover is reached by mouse or keyboard',
      control: { disable: true },
      table: {
        type: {
          summary: '"() => void"',
        },
      },
    },
    activator: {
      name: 'activator',
      description: 'The element to activate the Popover',
      control: { disable: true },
      table: {
        type: {
          summary: null,
        },
      },
    },
    content: {
      name: 'content',
      description: 'The content to display inside the popover',
      control: { disable: true },
      table: {
        type: {
          summary: null,
        },
      },
    },
    'extra-content': {
      name: 'extra-content',
      description: 'The content to display inside the popover parallel with content slot',
      control: { disable: true },
      table: {
        type: {
          summary: null,
        },
      },
    },
    default: {
      table: {
        disable: true,
      },
    },
  }}
/>

export const Template = (args, { argTypes }) => ({
  components: { ActionList, Button, Popover },
  data() {
    return {
      active: true,
      items: [
        { content: 'Import file' },
        { content: 'Export file' },
      ]
    };
  },
  methods: {
    toggleActive() {
      this.active = !this.active;
    },
  },
  template: `
    <Popover
      :active="active"
      autofocusTarget="first-node"
      v-on:close="toggleActive"
      on-close="toggleActive"
      :colorScheme="'${args.colorScheme}'"
    >
      <Button
        slot="activator"
        :disclosure="true"
        v-on:click="toggleActive"
        on-click="toggleActive"
      > More actions
      </Button>
      <ActionList slot="content" :items="items" data-items="items" />
    </Popover>`,
});

export const ContentAndActions = (args, { argTypes }) => ({
  components: { ActionList, Button, Popover, Pane, PopoverSection },
  data() {
    return {
      active: true,
      items: [
        {content: 'Online store'},
        {content: 'Facebook'},
        {content: 'Shopify POS'},
      ]
    };
  },
  methods: {
    toggleActive() {
      this.active = !this.active;
    },
  },
  template: ` <div>
    <Popover
      :active="active"
      autofocusTarget="first-node"
      v-on:close="toggleActive"
      on-close="toggleActive"
    >
      <Button
        slot="activator"
        :disclosure="true"
        v-on:click="toggleActive"
        on-click="toggleActive"
      > Sales channels
      </Button>
      <Pane slot="extra-content" :fixed="true">
        <PopoverSection>
          <p>Available sales channels</p>
        </PopoverSection>
      </Pane>
      <ActionList slot="content" actionRole="menuitem" :items="items" data-items="items" />
    </Popover>
  </div>`,
});
ContentAndActions.storyName = 'With content and actions';
ContentAndActions.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/<template>\s*/, '')
        .replace(/\s*<\/template>/, '')
        .replace(/on-/g, 'v-on:')
        .replace(/:items='(.*)'\s*/g, '')
        .replace(/active/, ':active="active"')
        .replace(/data-items/g, ':items')
      const fullSource = dedent`
        data() {
          return {
            active: true,
            items: [
              {content: 'Online store'},
              {content: 'Facebook'},
              {content: 'Shopify POS'},
            ]
          };
        },
        methods: {
          toggleActive() {
            this.active = !this.active;
          },
        },
        ${tmpSource}
      `;
      return fullSource;
    },
  },
}

export const FormComponents = (args, { argTypes }) => ({
  components: { Button, Popover, FormLayout, FormItem, TextField, Select },
  data() {
    return {
      active: true,
      options: [{label: 'Tagged with', value: 'Tagged with'}],
      selectedValue: 'Tagged with',
      tagValue: '',
    };
  },
  methods: {
    toggleActive() {
      this.active = !this.active;
    },
    handleTagValueChange(value) {
      this.tagValue = value;
    },
  },
  template: ` <div>
    <Popover
      :active="active"
      aria-haspopup="false"
      :sectioned="true"
      v-on:close="toggleActive"
      on-close="toggleActive"
    >
      <Button
        slot="activator"
        :disclosure="true"
        v-on:click="toggleActive"
        on-click="toggleActive"
      > Filter
      </Button>
      <FormLayout slot="content">
        <FormItem>
          <Select :options="options" v-model="selectedValue" data-model="selectedValue">
            <template slot="label">Show all customers where:</template>
          </Select>
        </FormItem>
        <FormItem>
          <TextField
            :value="tagValue"
            data-Value="tagValue"
            @change="handleTagValueChange"
            on-change="handleTagValueChange"
            autoComplete="off"
          >
            <template slot="label">Tags</template>
          </TextField>
        </FormItem>
        <FormItem>
          <Button size="slim">Add filter</Button>
        </FormItem>
      </FormLayout>
    </Popover>
  </div>`,
});
FormComponents.storyName = 'With form components';
FormComponents.parameters = {
  docs: {
    source: false,
    transformSource: (source) => {
      const tmpSource = source
        .replace(/on-/g, 'v-on:')
        .replace(/value=".*"\s*/g, '')
        .replace(/data-Value/g, ':value')
        .replace(/data-model/g, 'v-model')
        .replace(/active/, ':active="active"')
        .replace(/data-items/g, ':items')
      const fullSource = dedent`
        data() {
          return {
            active: true,
            options: [{label: 'Tagged with', value: 'Tagged with'}],
            selectedValue: 'Tagged with',
            tagValue: '',
          };
        },
        methods: {
          toggleActive() {
            this.active = !this.active;
          },
          handleTagValueChange(value) {
            this.tagValue = value;
          },
        },
        ${tmpSource}
      `;
      return fullSource;
    },
  },
}

# Popover

Popovers are small overlays that open on demand. They let merchants access additional content and actions without cluttering the page.

For ActionList usages, use the [ActionList component.](/docs/components-actions-actionlist--action-list)

<font color="red"> Can not test props on this component due to inline Story. Try it on your own project. </font>

<br/><br/><br/>

### With Content and Actions

<Canvas style={{ backgroundColor: '#f6f6f7' }}>
  <Story story={ContentAndActions} height="280px" inline={false} />
</Canvas>

### With Form Components

<Canvas style={{ backgroundColor: '#f6f6f7' }}>
  <Story story={FormComponents} height="280px" inline={false} />
</Canvas>

### Example

<Canvas style={{ backgroundColor: '#f6f6f7' }}>
  <Story
    name="Popover"
    inline={false}
    height="300px"
    args={{
      colorScheme: 'light',
    }}
    parameters={{
      docs: {
        transformSource: (source) => {
          const tmpSource = source
            .replace(/on-/g, 'v-on:')
            .replace(/:items='(.*)'\s*/g, '')
            .replace(/active/, ':active="active"')
            .replace(/data-items/g, ':items');
          const fullSource = dedent`
            ${tmpSource}
            data() {
              return {
                active: true,
                items: [
                  { content: 'Import file' },
                  { content: 'Export file' },
                ]
              };
            },
            methods: {
              toggleActive() {
                this.active = !this.active;
              },
            },
          `;
          return fullSource;
        },
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Popover" />
